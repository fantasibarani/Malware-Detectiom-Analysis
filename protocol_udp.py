import dpkt
import os
import pcapy as p
from scapy.all import *
from collections import Counter
# print '-----------------------------'
hit1_udp=0
hit2_udp=0
hit3_udp=0
kalk_udp=0
rod_udp_1=0
rod_udp_2=0
rod_udp_3=0
size_a=0
size_b=0
size_c=0
http=0
protokol_dns1=[]
protokol_dns2=[]
protokol_dns3=[]
a_pr=0
b=0
c=0
filename='dump.pcap'
# untuk setiap ts, pkt pada dump.pcap file
# print 'Akses Port udp yang dilakukan'
# print '-----------------------------'
for ts, pkt in dpkt.pcap.Reader(open(filename,'r')):
  eth=dpkt.ethernet.Ethernet(pkt) 
  if eth.type !=dpkt.ethernet.ETH_TYPE_IP:
    continue
  ip=eth.data
  if ip.p==dpkt.ip.IP_PROTO_UDP: 
    udp = ip.data
  try :
    if int(format(udp.dport)) in range (0,1023) :
      rod_udp_1+=1
      hit1_udp=1
      protokol_dns1.append(int(format(udp.dport)))
      # print "Well  Known Port udp"
    elif int(format(udp.dport)) in range (1024,49152) :
      rod_udp_2+=1
      hit2_udp=1
      protokol_dns2.append(int(format(udp.dport)))
      # print "Registered Port udp"
    elif int(format(udp.dport))in range (49152,65537):
      rod_udp_3+=1
      hit3_udp=1
      protokol_dns3.append(int(format(udp.dport)))
      # print "Dynamic Assigned Port udp"
  except:
    print "---."


print "---------------------------------" 
# print "DNS 1     : ", hit1_udp
prodnsudp1=Counter(protokol_dns1)
# print prodnsudp1
for indeks in range(len(prodnsudp1)):
  a_pr=a_pr+1 
# print "Jumlah Node DNS 1 : ", a
print "---------------------------------"
# print "DNS 2     : ", hit2_udp
prodnsudp2=Counter(protokol_dns2)
# print prodnsudp2
for indeks in range(len(prodnsudp2)):
  b=b+1 
# print "Jumlah Node DNS 2 : ", b
print "---------------------------------"
# print "DNS 3     : ", hit3_udp
prodnsudp3=Counter(protokol_dns3)
# print prodnsudp3
for indeks in range(len(prodnsudp3)):
  c=c+1 
# print "Jumlah Node DNS 3 : ", c
print "---------------------------------"

if hit1_udp!=0:
  size_a=1
if hit2_udp!=0:
  size_b=1
if hit3_udp!=0:
  size_c=1
# dns_node_udp=size_a+size_b+size_c
# # print dns_node_udp

# print "---------------------------------"
root_out_udp=rod_udp_1+rod_udp_2+rod_udp_3
# print root_out_udp
  